<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>TransCraft 設定</title>
    <link rel="stylesheet" href="css/options.css">
</head>
<body>
    <div class="container">
        <h1>TransCraft 設定</h1>
        
        <div class="section">
            <h2>選擇翻譯服務</h2>
            <div class="radio-group">
                <label>
                    <input type="radio" name="api" value="openai" id="openai-radio">
                    OpenAI (ChatGPT)
                </label>
                <label>
                    <input type="radio" name="api" value="claude" id="claude-radio">
                    Claude (Anthropic)
                </label>
                <label>
                    <input type="radio" name="api" value="gemini" id="gemini-radio">
                    Gemini (Google)
                </label>
                <label>
                    <input type="radio" name="api" value="openrouter" id="openrouter-radio">
                    OpenRouter
                </label>
                <label>
                    <input type="radio" name="api" value="ollama" id="ollama-radio">
                    Ollama (本地)
                </label>
            </div>
        </div>

        <div class="section">
            <h2 id="api-section-title">API Key 設定</h2>
            <p class="section-description">請先選擇翻譯服務，然後設定對應的 API Key</p>
            
            <div class="api-section" id="openai-section" style="display: none;">
                <h3>🤖 OpenAI API Key</h3>
                <input type="password" id="openai-key" placeholder="sk-proj-...">
                <p class="help-text">
                    從 <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a> 取得
                    <br><small>支援 GPT-4o、GPT-4o Mini、GPT-3.5 Turbo</small>
                </p>
            </div>

            <div class="api-section" id="claude-section" style="display: none;">
                <h3>🧠 Claude API Key</h3>
                <input type="password" id="claude-key" placeholder="sk-ant-...">
                <p class="help-text">
                    從 <a href="https://console.anthropic.com/api-keys" target="_blank">Anthropic Console</a> 取得
                    <br><small>支援 Claude 3.5 Sonnet、Claude 3 Haiku</small>
                </p>
            </div>

            <div class="api-section" id="gemini-section" style="display: none;">
                <h3>✨ Gemini API Key</h3>
                <input type="password" id="gemini-key" placeholder="AIza...">
                <p class="help-text">
                    從 <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a> 取得
                    <br><small>支援 Gemini 1.5 Flash、Gemini 1.5 Pro</small>
                </p>
            </div>

            <div class="api-section" id="openrouter-section" style="display: none;">
                <h3>🌐 OpenRouter API Key</h3>
                <input type="password" id="openrouter-key" placeholder="sk-or-v1-...">
                <p class="help-text">
                    從 <a href="https://openrouter.ai/keys" target="_blank">OpenRouter</a> 取得
                    <br><small>支援 Claude、GPT、Llama、Gemini 等多種模型</small>
                </p>
                <div class="openrouter-setup-info">
                    <details>
                        <summary>⚠️ 重要設定步驟</summary>
                        <ol>
                            <li><strong>1. 獲取 API Key：</strong>到 <a href="https://openrouter.ai/keys" target="_blank">OpenRouter Keys</a> 創建 API Key</li>
                            <li><strong>2. 配置隱私設定：</strong>到 <a href="https://openrouter.ai/settings/privacy" target="_blank">隱私設定</a></li>
                            <li><strong>3. 啟用模型訓練：</strong>勾選 "Allow training on prompts" 或類似選項</li>
                            <li><strong>4. 保存設定：</strong>確保設定已保存後再測試連接</li>
                            <li><strong>5. 等待生效：</strong>設定可能需要幾分鐘才會生效</li>
                        </ol>
                        <p><small>💡 注意：如果不啟用 prompt training，某些免費模型將無法使用</small></p>
                    </details>
                </div>
            </div>

            <div class="api-section" id="ollama-section" style="display: none;">
                <h3>🦙 Ollama 本地服務</h3>
                <input type="text" id="ollama-key" placeholder="無需 API Key（本地運行）" disabled style="background-color: #f5f5f5;">
                <p class="help-text">
                    請確認 <a href="https://ollama.ai" target="_blank">Ollama</a> 已安裝並運行在 localhost:11434
                    <br><small>本地 AI 模型，完全私密，無需網路連線</small>
                </p>
                <div class="ollama-setup-info">
                    <details>
                        <summary>📋 快速設定指南</summary>
                        <ol>
                            <li>下載並安裝 <a href="https://ollama.ai" target="_blank">Ollama</a></li>
                            <li>開啟終端機執行：<code>ollama serve</code></li>
                            <li>下載模型：<code>ollama pull llama3.1:8b</code></li>
                            <li>測試連接：<code>ollama list</code></li>
                        </ol>
                    </details>
                </div>
            </div>

            <div class="no-service-selected" id="no-service-message">
                <div class="placeholder-icon">⚙️</div>
                <p>請先選擇翻譯服務</p>
            </div>
        </div>

        <div class="section">
            <h2>預設設定</h2>
            
            <div class="form-group">
                <label for="target-language">目標語言</label>
                <select id="target-language">
                    <option value="zh-TW">繁體中文</option>
                    <option value="zh-CN">簡體中文</option>
                    <option value="en">英文</option>
                    <option value="ja">日文</option>
                    <option value="ko">韓文</option>
                    <option value="es">西班牙文</option>
                    <option value="fr">法文</option>
                    <option value="de">德文</option>
                </select>
            </div>

            <div class="form-group" id="model-selection-group" style="display: none;">
                <label for="model-select">AI 模型</label>
                <select id="model-select">
                    <!-- 動態填充選項 -->
                </select>
                <div class="model-info" id="model-info">
                    <!-- 動態顯示模型說明 -->
                </div>
            </div>

            <div class="no-model-available" id="no-model-message">
                <div class="placeholder-icon">🤖</div>
                <p>請先選擇翻譯服務以查看可用的 AI 模型</p>
            </div>
        </div>

        <div class="section">
            <h2>翻譯批次設定</h2>
            <p class="section-description">調整翻譯處理的批次大小，影響翻譯速度和 API 使用效率</p>
            
            <div class="form-group">
                <label for="max-batch-length">批次最大字元數</label>
                <input type="number" id="max-batch-length" min="1000" max="32000" step="1000" value="8000">
                <small class="help-text">單次翻譯請求的最大字元數，建議範圍：2000-16000</small>
            </div>

            <div class="form-group">
                <label for="max-batch-elements">批次最大元素數</label>
                <input type="number" id="max-batch-elements" min="5" max="50" step="5" value="20">
                <small class="help-text">單次翻譯請求的最大元素數量，建議範圍：10-30</small>
            </div>

            <div class="batch-info">
                <div class="info-item">
                    <strong>較小批次：</strong>翻譯速度較慢，但更穩定，適合複雜內容
                </div>
                <div class="info-item">
                    <strong>較大批次：</strong>翻譯速度較快，但可能影響品質，適合簡單內容
                </div>
            </div>
        </div>

        <!-- YouTube 字幕翻譯設定 -->
        <div class="section">
            <h2>YouTube 字幕翻譯</h2>
            <p class="section-description">設定 YouTube 影片字幕的即時翻譯功能</p>
            
            <div class="form-group">
                <label class="checkbox-container">
                    <input type="checkbox" id="youtube-subtitle-enabled" class="form-checkbox"> 
                    <span class="checkmark"></span>
                    啟用 YouTube 字幕翻譯
                </label>
                <small class="help-text">在 YouTube 影片頁面自動翻譯字幕</small>
            </div>
            
            <div class="youtube-settings" id="youtube-settings" style="display: none;">
                <div class="form-group">
                    <label for="youtube-translation-mode">翻譯模式</label>
                    <select id="youtube-translation-mode" class="form-select">
                        <option value="realtime">即時翻譯 (逐句翻譯，響應最快)</option>
                        <option value="batch">批次翻譯 (累積多句一起翻譯，成本較低)</option>
                        <option value="preload">預載翻譯 (下載字幕檔一次性翻譯，品質最佳)</option>
                    </select>
                    <small class="help-text">
                        <strong>即時翻譯：</strong>每句字幕立即翻譯，響應速度最快<br>
                        <strong>批次翻譯：</strong>收集多句後一起翻譯，節省API成本，翻譯更連貫<br>
                        <strong>預載翻譯：</strong>開始播放前下載完整字幕並翻譯，品質最佳但需等待
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-container">
                        <input type="checkbox" id="hide-original-subtitles" class="form-checkbox"> 
                        <span class="checkmark"></span>
                        隱藏原始字幕
                    </label>
                    <small class="help-text">隱藏 YouTube 原生字幕，只顯示翻譯後的字幕</small>
                </div>
                
                <div class="form-group">
                    <label for="subtitle-font-size">字幕字體大小</label>
                    <select id="subtitle-font-size" class="form-select">
                        <option value="14px">小 (14px)</option>
                        <option value="16px">中小 (16px)</option>
                        <option value="18px" selected>中 (18px)</option>
                        <option value="20px">大 (20px)</option>
                        <option value="24px">特大 (24px)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="subtitle-position">字幕位置</label>
                    <select id="subtitle-position" class="form-select">
                        <option value="bottom" selected>底部</option>
                        <option value="top">頂部</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="subtitle-background-opacity">背景透明度</label>
                    <select id="subtitle-background-opacity" class="form-select">
                        <option value="0.6">60%</option>
                        <option value="0.8" selected>80%</option>
                        <option value="0.9">90%</option>
                        <option value="1.0">100%</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>專家模式管理</h2>
            <p class="section-description">自定義不同類型內容的翻譯提示詞</p>
            
            <div class="expert-modes-list" id="expert-modes-list">
                <!-- 動態填充專家模式列表 -->
            </div>
            
            <button id="add-expert-mode-button" class="secondary-button">
                <span>+ 新增專家模式</span>
            </button>
        </div>

        <div class="button-group">
            <button id="save-button" class="primary-button">儲存設定</button>
            <button id="test-button" class="secondary-button">測試連接</button>
        </div>

        <div id="status-message" class="status-message"></div>
    </div>

    <!-- 專家模式編輯模態窗 -->
    <div id="expert-mode-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">新增專家模式</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="expert-mode-id">模式 ID</label>
                    <input type="text" id="expert-mode-id" placeholder="例如: novel, technical, academic">
                    <small class="help-text">唯一識別碼，只能包含英文字母、數字和底線</small>
                </div>
                
                <div class="form-group">
                    <label for="expert-mode-name">模式名稱</label>
                    <input type="text" id="expert-mode-name" placeholder="例如: 小說模式">
                </div>
                
                <div class="form-group">
                    <label for="expert-mode-description">模式描述</label>
                    <input type="text" id="expert-mode-description" placeholder="例如: 適合文學作品翻譯，保持文學性和情感表達">
                </div>
                
                <div class="form-group">
                    <label for="expert-mode-prompt">系統提示詞</label>
                    <textarea id="expert-mode-prompt" rows="8" placeholder="例如: You are a literary translator specializing in novels and creative works. Translate the following text to {targetLanguage}..."></textarea>
                    <small class="help-text">使用 {targetLanguage} 作為目標語言的佔位符</small>
                </div>
            </div>
            <div class="modal-footer">
                <button id="modal-cancel" class="secondary-button">取消</button>
                <button id="modal-save" class="primary-button">儲存</button>
            </div>
        </div>
    </div>

    <script src="js/options.js"></script>
</body>
</html>